version: "3.7"
services:
  previewer:
    build:
      context: ../../
      dockerfile: ./build//docker/previewer/Dockerfile
    environment:
      - LOG_LEVEL=error
      - HTTP_LISTEN=:8013
      - IMAGE_MAX_FILE_SIZE=1000000
      - CACHE_SIZE=100000000
      - CACHE_TYPE=disk
      - CACHE_TYPE=./cache
    depends_on:
      - nginx
  nginx:
    image: nginx:alpine
    volumes:
      - ./../../tests/html:/usr/share/nginx/html
    logging:
      driver: none
  tests:
    image: golang:1.14
    volumes:
      - ./../../tests/go:/tests
    command: sh -c 'cd /tests && sleep 2 && go test -v'
    depends_on:
      - previewer


